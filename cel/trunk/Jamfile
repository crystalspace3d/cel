# This file will be processed by the configure script
SubDir TOP ;

# Construct a distclean target
CleanDir clean : out ;

Clean distclean : configure.lineno config.status config.status.lineno
		  config.log config.cache aclocal.m4
		  Makefile Jamconfig autom4te.cache ;
Depends distclean : clean ;

Clean maintainerclean : configure aclocal.m4 config.h.in ;
Depends maintainerclean : distclean ;

Help clean : "Cleanup objectfiles and targets" ;
Help distclean : "Cleanup objectfiles and build configuration" ;
Help maintainerclean :
		"Cleanup all objectfiles, buildconfig and generated files." ;

# include subdirectories
SubInclude TOP docs ;
SubInclude TOP include ;
SubInclude TOP libs ;
SubInclude TOP plugins ;
SubInclude TOP apps ;

# generate cel-config
rule CelConfigGen
{
  LOCATE on $(>) = $(SUBDIR) ;
  MakeLocate $(<) : $(LOCATE.TARGETS) ;
  Depends $(<) : $(>) ;
  Clean clean : $(<) ;
}

actions CelConfigGen
{
  cat > $(<) << __END__
#!/bin/sh

prefix="$(INSTALLDIR.PREFIX)"
exec_prefix="\${prefix}"
version="$(PACKAGE.VERSION)"
# test for release/source directory
if test -e "\${CEL}/include/physicallayer/pl.h"; then
  includedir="\${CEL}/include"
else
  includedir="$(INSTALLDIR.INCLUDE)"
fi
plugindir="$(INSTALLDIR.PLUGIN)"
cflags="-I\${includedir}"
libs="celtool"
__END__
  cat $(>) >> $(<)
  chmod +x $(<)
}

CelConfigGen cel-config : cel-config.template ;
Depends cel-config : Jamfile Jamconfig ;
Depends all : cel-config ;
InstallShellScript cel-config ;

# deprecated...
InstallShellScript cel.cex ;
