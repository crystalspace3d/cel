SubDir TOP plugins behaviourlayer python ;

if $(PYTHON.AVAILABLE) = yes
{
  #--------
  # Swig-generated files.
  #--------
  local blcelcpp = blcel.cpp ;
  local blcelpy = [ DoSourceGrist blcelc.py ] ;
  local blcelpydir ;

  if ! [ Property build : projgen ]
  {
    blcelcpp = [ DoSourceGrist $(blcelcpp) ] ;

    if $(CMD.SWIG)
    {
      Swig $(blcelcpp) $(blcelpy) :
        [ DoSourceGrist blcel.i ] :
        python :
	-c++ -shadow :
	[ ConcatDirs $(TOP) include ] $(CRYSTAL.INCLUDE_DIR) :
	:
	$(SEARCH_SOURCE) [ ConcatDirs $(TOP) scripts ] :
	blcel ;
      Depends blpythonclean : blcelswigclean ;
      blcelpydir = $(LOCATE_TARGET) ;
    }
    else
    {
      SEARCH on $(blcelcpp) = $(SEARCH_SOURCE) ;
      blcelpydir = [ ConcatDirs $(TOP) scripts ] ;
    }
  }

  rule InstallCSPythonPY
  {
    local SUBDIR = $(2) ; # Temporary override for InstallData.
    InstallData $(1) : $(3) ;
  }
  InstallCSPythonPY $(blcelpy) : $(blcelpydir) : python ;


  #--------
  # blpython plugin.
  #--------
  Plugin blpython : $(blcelcpp) blpython.cpp blpython.h pytocel.cpp ;
  ExternalLibs blpython : PYTHON CRYSTAL ;
  CFlags blpython : [ FDefines SWIG_GLOBAL ] ;
}
