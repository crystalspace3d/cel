<library>
  <textures>
    <texture name="wood"> <file>/lib/stdtex/parket.jpg</file> </texture>
    <texture name="marble"> <file>/lib/stdtex/andrew_marble4.jpg</file> </texture>
  </textures>
  <materials>
    <material name="wood"> <texture>wood</texture> </material>
    <material name="marble"> <texture>marble</texture> </material>
  </materials>

  <library path="/lib/frankie" file="frankie.xml" />

  <meshfact name="Block">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.2" y="0" z="-.2" /> <max x=".2" y=".4" z=".2" /> </box>
      <material>wood</material>
    </params>
  </meshfact>
  <meshfact name="Domino">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.5" y="0" z="-.06" /> <max x=".5" y="2" z=".06" /> </box>
      <material>wood</material>
    </params>
  </meshfact>
  <meshfact name="Clicker">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.2" y="0" z="-.2" /> <max x=".2" y=".4" z=".2" /> </box>
      <material>wood</material>
    </params>
  </meshfact>
  <meshfact name="Gold">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="Diamond">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="Silver">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="Ruby">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="Emerald">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="Iron">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="Copper">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box> <min x="-.1" y="0" z="-.1" /> <max x=".1" y=".2" z=".1" /> </box>
      <material>marble</material>
    </params>
  </meshfact>
  <meshfact name="MoneySpawn">
    <nullmesh>
      <min x="-1" y="-1" z="-1" /> <max x="1" y="1" z="1" />
    </nullmesh>
  </meshfact>

  <addon plugin="cel.addons.dynamicworld.loader">
    <dynworld name="world" />
    <factory name="franky_frankie" maxradius="1" imposterradius="-1.0" mass="50"> <cylinder /> </factory>
    <factory name="Table" template="Table" maxradius="0.5" imposterradius=".4" mass="4">
      <box> <offset x="0" y="0.95" z="0" /> <size x="2" y="0.1" z="1.2" /> </box>
      <box> <offset x="-0.91" y="0.475" z="-0.51" /> <size x=".08" y="0.9" z=".08" /> </box>
      <box> <offset x="0.91" y="0.475" z="-0.51" /> <size x=".08" y="0.9" z=".08" /> </box>
      <box> <offset x="-0.91" y="0.475" z="0.51" /> <size x=".08" y="0.9" z=".08" /> </box>
      <box> <offset x="0.91" y="0.475" z="0.51" /> <size x=".08" y="0.9" z=".08" /> </box>
    </factory>

    <factory name="Barrel" template="Barrel" maxradius="1.0" imposterradius="-1.0" mass="1"> <cylinder /> </factory>
    <factory name="Block" template="Block" maxradius="0.9" imposterradius="-1.0" mass=".6"> <box /> </factory>
    <factory name="Domino" template="Domino" maxradius="0.9" imposterradius="-1.0" mass="10"> <box /> </factory>
    <factory name="Clicker" template="Clicker" maxradius="0.9" imposterradius="-1.0" mass=".6"> <box /> </factory>
    <factory name="Money" template="Money" maxradius="0.7" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Can" template="Can" maxradius="0.7" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Cup" template="Cup" maxradius="0.7" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Milk" template="Milk" maxradius="0.7" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Steak" template="Steak" maxradius="0.7" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Apple" template="Apple" maxradius="0.6" imposterradius="-1.0" mass=".4"> <sphere /> </factory>
    <factory name="Door" template="Door" maxradius="0.9" imposterradius=".4" mass="2"> <box /> </factory>

    <factory name="Gold" template="Gold" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Diamond" template="Diamond" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Silver" template="Silver" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Ruby" template="Ruby" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Emerald" template="Emerald" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Iron" template="Iron" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
    <factory name="Copper" template="Copper" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>

    <factory name="MoneySpawn" template="MoneySpawn" maxradius="1" imposterradius="-1.0" mass="0"> </factory>
  </addon>

    <addon plugin="cel.addons.questdef" >

      <quest name="clickerObject">
	<state name="init">
	  <trigger type="message">
	    <fireon entity="$this" mask="elcm.activate" />
	    <reward type="debugprint" message="=?counter" />
	    <reward type="changeproperty" entity="$this" property="counter" diff="1" />
	    <reward type="newstate" state="init" />
	  </trigger>
	</state>
      </quest>

      <quest name="glowQuest">
        <state name="init">
	  <oninit>
	    <reward sequence='animglow' type='sequence' entity='$this' entity_tag='glow' />
	  </oninit>
	  <trigger type="sequencefinish">
	    <fireon entity="$this" sequence="animglow" entity_tag='glow'/>
	    <reward type="newstate" state="init2" />
	  </trigger>
        </state>
	<state name="init2">
	  <oninit>
	    <reward type="newstate" state="init" />
	  </oninit>
	</state>
        <sequence name="animglow">
          <op entity="$this" type="ambientmesh" duration="$dur" >
	    <abscolor red="0" green="0" blue="1" />
          </op>
	  <delay time="$dur" />
          <op entity="$this" type="ambientmesh" duration="$dur" >
	    <abscolor red="1" green="0" blue="0" />
          </op>
	  <delay time="$dur" />
        </sequence>
      </quest>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="BasePlayer" >
      <propclass name="pcobject.mesh" />
      <propclass name="pcinput.standard">
	<action name="Bind">
	  <par name="trigger" string="left" />
	  <par name="command" string="rotateleft" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="right" />
	  <par name="command" string="rotateright" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="up" />
	  <par name="command" string="forward" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="down" />
	  <par name="command" string="backward" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="a" />
	  <par name="command" string="rotateleft" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="d" />
	  <par name="command" string="rotateright" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="w" />
	  <par name="command" string="forward" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="s" />
	  <par name="command" string="backward" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="q" />
	  <par name="command" string="strafeleft" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="e" />
	  <par name="command" string="straferight" />
	</action>
	<action name="Bind">
	  <par name="trigger" string="space" />
	  <par name="command" string="jump" />
	</action>
      </propclass>
      <propclass name="pctools.inventory">
	<action name="AddTemplate">
	  <par name="name" string="Money" />
	  <par name="amount" long="100" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Barrel" />
	  <par name="amount" long="1" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Domino" />
	  <par name="amount" long="1" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Can" />
	  <par name="amount" long="2" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Cup" />
	  <par name="amount" long="2" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Milk" />
	  <par name="amount" long="1" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Steak" />
	  <par name="amount" long="1" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Apple" />
	  <par name="amount" long="1" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Diamond" />
	  <par name="amount" long="1" />
	</action>
	<action name="AddTemplate">
	  <par name="name" string="Ruby" />
	  <par name="amount" long="1" />
	</action>
      </propclass>
      <propclass name="pccamera.delegate" />
      <propclass name="pccamera.mode.tracking">
	<property name="pan_topspeed" float="2.5" />
	<property name="tilt_topspeed" float="1.2" />
      </propclass>
      <propclass name="pcmove.linear">
        <action name="InitCD" >
          <par name="body" vector3=".5,.4,.5" />
          <par name="legs" vector3=".5,.2,.5" />
          <par name="offset" vector3="0,0,0" />
	</action>
      </propclass>
      <propclass name="pcmove.actor.standard">
	<action name="SetSpeed">
	  <par name="movement" float="5" />
	  <par name="running" float="8" />
	  <par name="rotation" float="2" />
	</action>
	<action name="Subscribe" />
      </propclass>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="Base" >
      <propclass name="pcobject.mesh" />
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="BaseClicker" >
      <propclass name="pcobject.mesh" />
      <propclass name="pctools.properties">
	<property name="counter" long="1" />
      </propclass>
      <propclass name="pclogic.quest" tag="glow">
        <action name="NewQuest" >
          <par name="name" string="glowQuest" />
          <par name="dur" string="100" />
        </action>
        <property name="state" string="init" />
      </propclass>
      <propclass name="pclogic.quest" tag="clicker">
        <action name="NewQuest" >
          <par name="name" string="clickerObject" />
        </action>
        <property name="state" string="init" />
      </propclass>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="BasePickup" >
      <propclass name="pcobject.mesh" />
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="MoneySpawn" >
      <template name="Base" />
      <propclass name="pclogic.spawn">
        <action name="AddEntityTemplateType">
	  <par name="template" string="Money" />
	</action>
        <action name="SetTiming">
	  <par name="repeat" bool="true" />
	  <par name="random" bool="true" />
	  <par name="mindelay" long="1000" />
	  <par name="maxdelay" long="5000" />
	</action>
        <action name="AddSpawnPosition">
	  <par name="sector" string="$sector" />
	  <par name="position" vector3="$pos" />
	</action>
	<action name="Inhibit">
	  <par name="count" long="5" />
	</action>
	<property name="spawnunique" bool="true" />
	<property name="namecounter" bool="false" />
      </propclass>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="Door" >
      <template name="Base" />
      <propclass name="pclogic.wire">
	<action name="AddInput">
	  <par name="mask" string="elcm.activate" />
	</action>
	<action name="AddOutput">
	  <par name="msgid" string="elcm.teleport" />
	  <par name="entity" string="world" />
	  <par name="cell" string="$cell" />
	  <par name="pos" vector3="$pos" />
	</action>
      </propclass>
      <characteristic name="weight" value="50" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="franky_frankie" >
      <propclass name="pcobject.mesh">
	<action name="LoadMesh">
	  <par name="factoryname" string="franky_frankie" />
	</action>
      </propclass>
      <merge name="BasePlayer" />
      <characteristic name="weight" value="50" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Table" >
      <template name="Base" />
      <characteristic name="weight" value="10" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Block" >
      <template name="Base" />
      <characteristic name="weight" value="1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Domino" >
      <template name="Base" />
      <characteristic name="weight" value="1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Clicker" >
      <template name="BaseClicker" />
      <characteristic name="weight" value="1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Money" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.02" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Apple" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Steak" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.2" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Can" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.5" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Milk" >
      <template name="BasePickup" />
      <characteristic name="weight" value="1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Cup" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.5" />
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="Gold" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.02" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Diamond" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.05" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Silver" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.01" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Ruby" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.04" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Emerald" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.04" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Iron" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.08" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Copper" >
      <template name="BasePickup" />
      <characteristic name="weight" value="0.08" />
    </addon>

    <addon plugin="cel.addons.lootloader">
    	<package name="ores" minloot="2" maxloot="6">
	    <item template="Gold" chance="0.1" minamount="1" maxamount="10" />
	    <item template="Diamond" chance="0.02" minamount="1" maxamount="5" />
	    <item template="Silver" chance="0.2" minamount="1" maxamount="10" />
	    <item template="Ruby" chance="0.04" minamount="1" maxamount="7" />
	    <item template="Emerald" chance="0.04" minamount="1" maxamount="7" />
	    <item template="Iron" chance="0.4" minamount="1" maxamount="20" />
	    <item template="Copper" chance="0.4" minamount="1" maxamount="20" />
	</package>
    	<package name="food" minloot="3" maxloot="6">
	    <item template="Can" chance="0.1" minamount="1" maxamount="2" />
	    <item template="Cup" chance="0.1" minamount="1" maxamount="2" />
	    <item template="Apple" chance="0.1" minamount="1" maxamount="4" />
	    <item template="Steak" chance="0.1" minamount="1" maxamount="2" />
	    <item template="Milk" chance="0.1" minamount="1" maxamount="2" />
	</package>
	<selector name="simpleboxloot">
	    <generator name="ores" chance="0.5" />
	    <generator name="food" chance="1" />
	</selector>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="Barrel" >
      <propclass name="pcobject.mesh" />
      <propclass name="pcphysics.object" />
      <propclass name="pclogic.wire">
	<action name="AddInput">
	  <par name="mask" string="elcm.activate" />
	</action>
	<action name="AddOutput">
	  <par name="msgid" string="elcm.inventory" />
	  <par name="entity" string="world" />
	  <par name="inventoryEntity" entity="$this" />
	</action>
      </propclass>
      <propclass name="pctools.inventory">
	<action name="SetLootGenerator">
	  <par name="name" string="simpleboxloot" />
	</action>
      </propclass>
      <characteristic name="weight" value="10.0" />
    </addon>

</library>
