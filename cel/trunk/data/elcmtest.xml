<library>
  <textures>
    <texture name="wood"> <file>/lib/stdtex/parket.jpg</file> </texture>
    <texture name="marble"> <file>/lib/stdtex/andrew_marble4.jpg</file> </texture>
  </textures>
  <materials>
    <material name="wood"> <texture>wood</texture> </material>
    <material name="marble"> <texture>marble</texture> </material>
  </materials>

  <meshfact name="GlowBox">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box>
        <min x="-.3" y="0" z="-.3" />
        <max x=".3" y=".6" z=".3" />
      </box>
      <material>wood</material>
    </params>
  </meshfact>

  <meshfact name="Gold">
    <plugin>crystalspace.mesh.loader.factory.genmesh</plugin>
    <params>
      <box>
        <min x="-.1" y="0" z="-.1" />
        <max x=".1" y=".2" z=".1" />
      </box>
      <material>marble</material>
    </params>
  </meshfact>

  <addon plugin="cel.addons.dynamicworld.loader">
    <dynworld name="world" />
    <factory name="GlowBox" maxradius="1.0" imposterradius="-1.0" mass="1"> <box /> </factory>
    <factory name="Gold" maxradius="0.8" imposterradius="-1.0" mass=".4"> <box /> </factory>
  </addon>

    <addon plugin="cel.addons.questdef" >

      <quest name="pickableObject">
	<state name="init">
	  <trigger type="meshselect">
	    <fireon entity="$this" />
	    <reward type="debugprint" message="pickme" />
	    <reward type="message" entity="world" id="elcm.pickup.tpl">
	      <par name="entity" string="$this" />
	    </reward>
	    <reward type="newstate" state="init" />
	  </trigger>
	</state>
      </quest>

      <quest name="jumperQuest">
	<state name="init">
	  <trigger type="meshselect">
	    <fireon entity="$this" />
	    <reward type="debugprint" message="select" />
	    <reward type="action" entity="$this" pc="pcphysics.object" id="AddForceOnce">
	      <par name="force" vector3="0,4,0" />
	    </reward>
	    <reward type="message" entity="world" id="elcm.inventory">
	      <par name="entity" string="$this" />
	    </reward>
	    <reward type="newstate" state="init" />
	  </trigger>
	</state>
      </quest>

      <quest name="glowQuest">
        <state name="init">
	  <oninit>
	    <reward sequence='animglow' type='sequence' entity='$this' entity_tag='glow' />
	  </oninit>
	  <trigger type="sequencefinish">
	    <fireon entity="$this" sequence="animglow" entity_tag='glow'/>
	    <reward type="newstate" state="init2" />
	  </trigger>
        </state>
	<state name="init2">
	  <trigger type="timeout">
	    <fireon timeout='1' />
	    <reward type="newstate" state="init" />
	  </trigger>
	</state>
        <sequence name="animglow">
          <op entity="$this" type="ambientmesh" duration="$dur" >
	    <abscolor red="0" green="0" blue="1" />
          </op>
	  <delay time="$dur" />
          <op entity="$this" type="ambientmesh" duration="$dur" >
	    <abscolor red="1" green="0" blue="0" />
          </op>
	  <delay time="$dur" />
        </sequence>
      </quest>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="Base" >
      <propclass name="pcobject.mesh" />
      <propclass name="pcobject.mesh.select">
        <action name="SetCamera" >
          <par name="entity" string="player" />
        </action>
      </propclass>
      <propclass name="pclogic.quest" tag="pickup">
        <action name="NewQuest" >
          <par name="name" string="pickableObject" />
        </action>
        <property name="state" string="init" />
      </propclass>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="Gold" >
      <template name="Base" />
      <characteristic name="weight" value="0.02" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Diamond" >
      <characteristic name="weight" value="0.05" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Silver" >
      <characteristic name="weight" value="0.01" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Ruby" >
      <characteristic name="weight" value="0.04" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Emerald" >
      <characteristic name="weight" value="0.04" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Iron" >
      <characteristic name="weight" value="0.08" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Copper" >
      <characteristic name="weight" value="0.08" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Book" >
      <characteristic name="weight" value="0.5" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Paper" >
      <characteristic name="weight" value="0.1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Pen" >
      <characteristic name="weight" value="0.2" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Pencil" >
      <characteristic name="weight" value="0.2" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Note" >
      <characteristic name="weight" value="0.1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Feather" >
      <characteristic name="weight" value="0.1" />
    </addon>
    <addon plugin="cel.addons.celentitytpl" entityname="Glasses" >
      <characteristic name="weight" value="0.4" />
    </addon>

    <addon plugin="cel.addons.lootloader">
    	<package name="ores" minloot="2" maxloot="6">
	    <item template="Gold" chance="0.1" minamount="1" maxamount="10" />
	    <item template="Diamond" chance="0.02" minamount="1" maxamount="5" />
	    <item template="Silver" chance="0.2" minamount="1" maxamount="10" />
	    <item template="Ruby" chance="0.04" minamount="1" maxamount="7" />
	    <item template="Emerald" chance="0.04" minamount="1" maxamount="7" />
	    <item template="Iron" chance="0.4" minamount="1" maxamount="20" />
	    <item template="Copper" chance="0.4" minamount="1" maxamount="20" />
	</package>
    	<package name="reader" minloot="3" maxloot="6">
	    <item template="Book" chance="0.1" minamount="1" maxamount="2" />
	    <item template="Paper" chance="0.1" minamount="1" maxamount="5" />
	    <item template="Pen" chance="0.1" minamount="1" maxamount="4" />
	    <item template="Pencil" chance="0.1" minamount="1" maxamount="3" />
	    <item template="Note" chance="0.1" minamount="1" maxamount="1" />
	    <item template="Feather" chance="0.1" minamount="1" maxamount="3" />
	    <item template="Glasses" chance="0.1" minamount="1" maxamount="1" />
	</package>
	<selector name="simpleboxloot">
	    <generator name="ores" chance="0.5" />
	    <generator name="reader" chance="1" />
	</selector>
    </addon>

    <addon plugin="cel.addons.celentitytpl" entityname="GlowBox" >
      <propclass name="pcobject.mesh" />
      <propclass name="pcobject.mesh.select">
        <action name="SetCamera" >
          <par name="entity" string="player" />
        </action>
      </propclass>
      <propclass name="pcphysics.object" />
      <propclass name="pclogic.quest" tag="glow">
        <action name="NewQuest" >
          <par name="name" string="glowQuest" />
          <par name="dur" string="100" />
        </action>
        <property name="state" string="init" />
      </propclass>
      <propclass name="pclogic.quest" tag="jump">
        <action name="NewQuest" >
          <par name="name" string="jumperQuest" />
        </action>
        <property name="state" string="init" />
      </propclass>
      <propclass name="pctools.inventory">
	<action name="SetLootGenerator">
	  <par name="name" string="simpleboxloot" />
	</action>
      </propclass>
      <characteristic name="weight" value="10.0" />
    </addon>

</library>
